<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Bodoconsult.I18N | Bodoconsult.AppInfrastructure </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Bodoconsult.I18N | Bodoconsult.AppInfrastructure ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Bodoconsult/Bodoconsult.AppInfrastructure/blob/main/docs/Bodoconsult.I18N/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="Bodoconsult.AppInfrastructure">
            Bodoconsult.AppInfrastructure
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="bodoconsulti18n">Bodoconsult.I18N</h1>

<h1 id="what-does-the-library">What does the library</h1>
<h2 id="basic-ideas">Basic ideas</h2>
<p>Bodoconsult.I18N library is a simple localization library based on I18N-Portable <a href="https://github.com/xleon/I18N-Portable">https://github.com/xleon/I18N-Portable</a> by Diego Ponce de Le√≥n (xleon).</p>
<p>To use I18N-Portable directly was not possible for us. We required a localization library supporting resources from multiple assemblies and sources. We had to not only localize a WPF UI but report generation to PDF files and localized charting to images. The localization resources used for all this were spread of multiple assemblies and in different file formats. This led us to the need of a unique localization implementation usable in multiple environments like WinForms, WPF, console or Avalonia apps.</p>
<p>I18N-Portable did not support this.
But the general idea of I18N-Portable is cool. Therefore we decided to develop an own I18N-Portable derivative with similar published interfaces but working a bit different behind the scenes.</p>
<p>So the basic idea of Bodoconsult.I18N library is to simplify the usage of multiple technologies existing for localization like RESX resources and XAML resource dictionary under one roof.</p>
<p>Bodoconsult.I18N library currently supports I18N for apps with one currently loaded language at a time only but this language can be changed during runtime. Apps with multiple UI threads running on different languages are not supported currently.</p>
<p>Our implementation was intended for using it with console apps, WinForms apps or WPF apps under .Net8 or later. All other uses case may work but are not tested.</p>
<ul>
<li><p>Usable with a DI container</p>
</li>
<li><p>Simple initialization setup</p>
</li>
<li><p>Readable and lean locale files (UTF8 .txt with key/value pairs)</p>
</li>
<li><p>Support for custom file formats via ILocalesProvider interface (json, xml, etc)</p>
</li>
<li><p>Light weight</p>
</li>
<li><p>Well tested</p>
</li>
</ul>
<h2 id="localization-data-sources">Localization data sources</h2>
<p>Bodoconsult.I18N supports the following localization sources hosted maybe in different assemblies:</p>
<ul>
<li><p>TXT files</p>
</li>
<li><p>CSV files</p>
</li>
<li><p>JSON key value pairs files</p>
</li>
<li><p>Resx resource files</p>
</li>
<li><p>Embedded or external XAML resource files (.xaml extension) for WPF (additional Nuget package Bodoconsult.App.Wpf is required)</p>
</li>
<li><p>External AXAML resource files (.axaml extension) for Avalonia (additional Nuget package Bodoconsult.App.Avalonia is required)</p>
</li>
</ul>
<p>Implementing your own implemenation of IResourceProvider normally by deriving from BaseResourceProvider class you can implement your own localization provider based providing localization data from diverse source like file, databases, web resources via REST etc..</p>
<h1 id="how-to-use-the-library">How to use the library</h1>
<p>The source code contains NUnit test classes, the following source code samples are extracted from. The samples below show the most helpful use cases for the library.</p>
<h2 id="setup-locales">Setup locales</h2>
<ul>
<li><p>In your Net8 project, create a directory called &quot;Locales&quot;.</p>
</li>
<li><p>Create a <code>{languageCode}.txt</code> file for each language you want to support. <code>languageCode</code> can be a two letter ISO code or a IETF culture name like &quot;en-US&quot; or &quot;de-DE&quot;. See <a href="https://msdn.microsoft.com/en-us/library/ee825488%28v=cs.20%29.aspx">full list here</a>.</p>
</li>
<li><p>Set &quot;Build Action&quot; to &quot;Embedded Resource&quot; on the properties of each file</p>
</li>
<li><p>For available file formats see <a href="#locales--file-formats">File formats for locales</a></p>
</li>
</ul>
<p><strong>Locale content sample</strong></p>
<pre><code>    # key = value (the key will be the same across locales)
    one = uno
    two = dos
    three = tres 
    four = cuatro
    five = cinco
      
    # Enums are supported
    Animals.Dog = Perro
    Animals.Cat = Gato
    Animals.Rat = Rata
    Animals.Tiger = Tigre
    Animals.Monkey = Mono
     
    # Support for string.Format()
    stars.count = Tienes {0} estrellas
     
    TextWithLineBreakCharacters = Line One\nLine Two\r\nLine Three
     
    Multiline = Line One
        Line Two
        Line Three
</code></pre>
<h2 id="fluent-initialization">Fluent initialization</h2>
<pre><code class="lang-csharp">I18N.Current
    .SetNotFoundSymbol(&quot;$&quot;) // Optional: when a key is not found, it will appear as $key$ (defaults to &quot;$&quot;)
    .SetFallbackLocale(&quot;en&quot;) // Optional but recommended: locale to load in case the system locale is not supported
    .SetThrowWhenKeyNotFound(true) // Optional: Throw an exception when keys are not found (recommended only for debugging)
    .SetLogger(text =&gt; Debug.WriteLine(text)) // action to output traces
</code></pre>
<h2 id="using-i18n-without-depencency-injection">Using I18N without depencency injection</h2>
<p>The following code does not use Fluent to show the single steps necessary. It may be shortene by using Fluent.</p>
<pre><code class="lang-csharp">// **** Load all resources from one or more sources ****
// Add provider 1
ILocalesProvider provider = new I18NEmbeddedResourceLocalesProvider(GetType().Assembly,
    &quot;Bodoconsult.I18N.Test.Samples.Locales&quot;);

I18N.Current.AddProvider(provider);

// Add provider 2
provider = new I18NEmbeddedResourceLocalesProvider(GetType().Assembly,
    &quot;Bodoconsult.I18N.Test.Locales&quot;);

I18N.Current.AddProvider(provider);

Assert.IsTrue(I18N.Current.Languages.Any());

// **** Initialize all ****
// Set a fallback locale for the case current thread language is not available in the resources
I18N.Current.SetFallbackLocale(&quot;en&quot;);

// Load the default language from thread culture
I18N.Current.Init();


// **** Use it ****
// change to spanish (not necessary if thread language is ok)
I18N.Current.Locale = &quot;es&quot;;

var translation = I18N.Current.Translate(&quot;one&quot;);
Assert.AreEqual(&quot;uno&quot;, translation);

translation = &quot;Contains&quot;.Translate();
Assert.AreEqual(&quot;Contains&quot;, translation);


// Change to english
I18N.Current.Locale = &quot;en&quot;;

translation = I18N.Current.Translate(&quot;one&quot;);
Assert.AreEqual(&quot;one&quot;, translation);

translation = &quot;Contains&quot;.Translate();
Assert.AreEqual(&quot;Contains&quot;, translation);
</code></pre>
<h2 id="using-i18n-with-depencency-injection-and-bodoconsultappabstractionsdicontainer-class">Using I18N with depencency injection and Bodoconsult.App.Abstractions.DiContainer class</h2>
<h3 id="create-your-i18n-factory-based-on-basei18nfactory-class">Create your I18N factory based on BaseI18NFactory class</h3>
<p>The I18N factories based on BaseI18NFactory class are intended to create fully configured I18N instances with all locales loaded as required by your app.
To configure the I18N instance create an override for method CreateInstance() loading all providers as required.</p>
<pre><code class="lang-csharp">/// &lt;summary&gt;
/// Factory to create a fully configured I18N factory
/// &lt;/summary&gt;
public class TestI18NFactory: BaseI18NFactory
{
    /// &lt;summary&gt;
    /// Creating a configured II18N instance
    /// &lt;/summary&gt;
    /// &lt;returns&gt;An II18N instance&lt;/returns&gt;
    public override II18N CreateInstance()
    {
        // Set the fallback language
        I18NInstance.SetFallbackLocale(&quot;en&quot;);

        // Load a provider
        var provider = new I18NEmbeddedResourceLocalesProvider(TestHelper.CurrentAssembly,
            &quot;Bodoconsult.I18N.Test.Samples.Locales&quot;);

        I18NInstance.AddProvider(provider);

        // Load more providers if necessary
        // ...

        // Init instance with language from running thread
        I18NInstance.Init();

        // Return the instance
        return I18NInstance;
    }
}
</code></pre>
<p>If you use Bodoconsult.App app start infrastructure you can add the DI related code to the implementation of the method IDiContainerServiceProvider.AddServices as shown here in the sample:</p>
<pre><code class="lang-csharp">namespace AvaloniaApp1.DiContainerProvider;

/// &lt;summary&gt;
/// Load all specific AvaloniaApp1 services to DI container. Intended mainly for production
/// &lt;/summary&gt;
public class AvaloniaApp1AllServicesContainerServiceProvider : IDiContainerServiceProvider
{
    ...

    /// &lt;summary&gt;
    /// Add DI container services to a DI container
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;diContainer&quot;&gt;Current DI container&lt;/param&gt;
    public void AddServices(DiContainer diContainer)
    {
        // Factories to create tower instance related objects (should be singletons)
        diContainer.AddSingletonInstance(Globals.Instance.LogDataFactory);
        diContainer.AddSingleton&lt;IAppLoggerProxyFactory, AppLoggerProxyFactory&gt;();

        // benchmark
        var benchProxy = AppBenchProxy.CreateAppBenchProxy(_benchmarkFileName, Globals.Instance.LogDataFactory);
        diContainer.AddSingletonInstance(benchProxy);

        // General app management
        diContainer.AddSingleton&lt;IGeneralAppManagementService, GeneralAppManagementService&gt;();
        diContainer.AddSingleton&lt;IGeneralAppManagementManager, GeneralAppManagementManager&gt;();

        // I18N
        II18NFactory i18NFactory = new I18NFactory();
        diContainer.AddSingleton(i18NFactory.CreateInstance());

        // Load all other services required for the app now
        diContainer.AddSingleton&lt;IApplicationService, AvaloniaApp1Service&gt;();

        // ...
    }

    ...
}

</code></pre>
<h2 id="data-binding">Data binding</h2>
<p><code>I18N</code> implements <code>INotifyPropertyChanged</code> and it has an indexer to translate keys. For instance, you could translate a key like:</p>
<pre><code>string three = I18N.Current[&quot;three&quot;]; 
</code></pre>
<p>With that said, the easiest way to bind your views to <code>I18N</code> translations is to use the built-in indexer
by creating a proxy object in your ViewModel:</p>
<pre><code class="lang-csharp">public abstract class BaseViewModel
{
    public II18N TranslationService =&gt; I18N.Current;
}
</code></pre>
<p><strong>WPF Xaml sample</strong></p>
<pre><code class="lang-xaml">&lt;Button Content=&quot;{Binding TranslationService[key]}&quot; /&gt;
</code></pre>
<p>key is an existing key in a locales file.</p>
<p>See MainForm.xaml in WpfApp1 project in the repository.</p>
<p><strong>Avalonia XAML sample</strong></p>
<pre><code class="lang-xaml">&lt;Button Text=&quot;{Binding TranslationService[key]}&quot; /&gt;
</code></pre>
<p>key is an existing key in a locales file.</p>
<p>See MainForm.axaml in AvaloniaApp1 project in the repository.</p>
<p><strong>Xamarin.Forms sample</strong></p>
<pre><code class="lang-xaml">&lt;Button Text=&quot;{Binding TranslationService[key]}&quot; /&gt;`
</code></pre>
<p>key is an existing key in a locales file.</p>
<p><strong>WinForms sample</strong></p>
<p>WinForms does not support data binding to a indexer. Therefore you have to create a (readonly) property for each control containing translated text.</p>
<pre><code class="lang-csharp">/// &lt;summary&gt;
/// ViewModel for alternative main window Form1
/// &lt;/summary&gt;
public class WinFormsApp1MainWindowViewModel : MainWindowViewModel
{
  ...

  /// &lt;summary&gt;
  /// Property for binding to Text prop of label TranslationLabel
  /// &lt;/summary&gt;
  public string TranslationLabelText =&gt; TranslationService.Translate(&quot;Contains&quot;);

  ...
}
</code></pre>
<p>See Form1 in WinFormsApp1 project in the repository.</p>
<h2 id="locales--file-formats">Locales  file formats</h2>
<p>For all file formats currently implemented with Bodoconsult.I18N there are samples in the Bodoconsult.I18N.Test project in the repository.</p>
<h3 id="plain-text-files-txt">Plain text files (.txt)</h3>
<pre><code>one = one
two = two
three = three

Mailbox.Notification = Hello {0}, you've got {1} emails

TextWithLineBreakCharacters = Line One\nLine Two\r\nLine Three

Multiline = Line One
	Line Two
	Line Three

Animals = List of animals
Animals.Dog = Dog
Animals.Cat = Cat
Animals.Rat = Rat
Animals.Snake = Good\nSnake

Fruit.Orange = great orange
Fruit.Apple = big apple
Fruit.Banana = nice banana
</code></pre>
<h3 id="csv-text-files">CSV text files</h3>
<pre><code>one;one
two;two
three;three
Mailbox.Notification;Hello {0}, you've got {1} emails
TextWithLineBreakCharacters;Line One\nLine Two\nLine Three
Animals;List of animals
Animals.Dog;Dog
Animals.Cat;Cat
Animals.Rat;Rat
Animals.Snake;Good\nSnake
Fruit.Orange;great orange
Fruit.Apple;big apple
Fruit.Banana;nice banana
</code></pre>
<h3 id="json-key-value-pairs-file">JSON key-value-pairs file</h3>
<pre><code class="lang-json">{
  &quot;one&quot;: &quot;one&quot;,
  &quot;two&quot;: &quot;two&quot;,
  &quot;three&quot;: &quot;three&quot;,
  &quot;Mailbox.Notification&quot;: &quot;Hello {0}, you've got {1} emails&quot;,
  &quot;TextWithLineBreakCharacters&quot;: &quot;Line One\nLine Two\nLine Three&quot;,
  &quot;Animals&quot;: &quot;List of animals&quot;,
  &quot;Animals.Dog&quot;: &quot;Dog&quot;,
  &quot;Animals.Cat&quot;: &quot;Cat&quot;,
  &quot;Animals.Rat&quot;: &quot;Rat&quot;,
  &quot;Animals.Snake&quot;: &quot;Good\nSnake&quot;,
  &quot;Fruit.Orange&quot;: &quot;great orange&quot;,
  &quot;Fruit.Apple&quot;: &quot;big apple&quot;,
  &quot;Fruit.Banana&quot;: &quot;nice banana&quot;
}
</code></pre>
<h3 id="json-list-file">JSON list file</h3>
<pre><code class="lang-json">[
  {
    &quot;key&quot;: &quot;one&quot;,
    &quot;value&quot;: &quot;one&quot;
  },
  {
    &quot;key&quot;: &quot;two&quot;,
    &quot;value&quot;: &quot;two&quot;
  },
  {
    &quot;key&quot;: &quot;three&quot;,
    &quot;value&quot;: &quot;three&quot;
  },
  {
    &quot;key&quot;: &quot;Mailbox.Notification&quot;,
    &quot;value&quot;: &quot;Hello {0}, you've got {1} emails&quot;
  },
  {
    &quot;key&quot;: &quot;TextWithLineBreakCharacters&quot;,
    &quot;value&quot;: &quot;Line One\nLine Two\nLine Three&quot;
  },
  {
    &quot;key&quot;: &quot;Animals&quot;,
    &quot;value&quot;: &quot;List of animals&quot;
  },
  {
    &quot;key&quot;: &quot;Animals.Dog&quot;,
    &quot;value&quot;: &quot;Dog&quot;
  },
  {
    &quot;key&quot;: &quot;Animals.Cat&quot;,
    &quot;value&quot;: &quot;Cat&quot;
  },
  {
    &quot;key&quot;: &quot;Animals.Rat&quot;,
    &quot;value&quot;: &quot;Rat&quot;
  },
  {
    &quot;key&quot;: &quot;Animals.Snake&quot;,
    &quot;value&quot;: &quot;Good\nSnake&quot;
  },
  {
    &quot;key&quot;: &quot;Fruit.Orange&quot;,
    &quot;value&quot;: &quot;great orange&quot;
  },
  {
    &quot;key&quot;: &quot;Fruit.Apple&quot;,
    &quot;value&quot;: &quot;big apple&quot;
  },
  {
    &quot;key&quot;: &quot;Fruit.Banana&quot;,
    &quot;value&quot;: &quot;nice banana&quot;
  }
]
</code></pre>
<h3 id="wpf-xaml-file-as-embedded-resource-or-external-file">WPF XAML file as embedded resource or external file</h3>
<pre><code class="lang-xaml">&lt;ResourceDictionary xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
                    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
                    xmlns:system=&quot;clr-namespace:System;assembly=mscorlib&quot;&gt;
    &lt;system:String x:Key=&quot;Simulation.Asset&quot;&gt;Asset&lt;/system:String&gt;
    &lt;system:String x:Key=&quot;Simulation.Distribution&quot;&gt;Distribution&lt;/system:String&gt;
    &lt;system:String x:Key=&quot;Simulation.Parameter1&quot;&gt;Parameter 1&lt;/system:String&gt;
    &lt;system:String x:Key=&quot;Simulation.Parameter2&quot;&gt;Parameter 2&lt;/system:String&gt;
    &lt;system:String x:Key=&quot;Simulation.Parameter3&quot;&gt;Parameter 3&lt;/system:String&gt;
    &lt;system:String x:Key=&quot;Simulation.Percentage&quot;&gt;Percentage&lt;/system:String&gt;
&lt;/ResourceDictionary&gt;
</code></pre>
<h3 id="avalonia-xaml-file-only-as-external-file">Avalonia XAML file only as external file</h3>
<p>For AvaloniaResource files there is currently no way to read the key value pairs.</p>
<p>For embedding localization as resource in an Avalonia project use file formats like TXT, CSV, JSON or RESX as described above.</p>
<pre><code class="lang-xaml">&lt;ResourceDictionary xmlns=&quot;https://github.com/avaloniaui&quot;
                    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
                    xmlns:system=&quot;clr-namespace:System;assembly=System.Runtime&quot;&gt;
	&lt;system:String x:Key=&quot;Simulation.Asset&quot;&gt;Asset&lt;/system:String&gt;
	&lt;system:String x:Key=&quot;Simulation.Distribution&quot;&gt;Distribution&lt;/system:String&gt;
	&lt;system:String x:Key=&quot;Simulation.Parameter1&quot;&gt;Parameter 1&lt;/system:String&gt;
	&lt;system:String x:Key=&quot;Simulation.Parameter2&quot;&gt;Parameter 2&lt;/system:String&gt;
	&lt;system:String x:Key=&quot;Simulation.Parameter3&quot;&gt;Parameter 3&lt;/system:String&gt;
	&lt;system:String x:Key=&quot;Simulation.Percentage&quot;&gt;Percentage&lt;/system:String&gt;
&lt;/ResourceDictionary&gt;
</code></pre>
<h3 id="c-default-localization-with-resx-resource-files">C# default localization with resx resource files</h3>
<p>For more information see <a href="https://learn.microsoft.com/en-us/dotnet/core/extensions/localization">MS Learn: Localization in .NET</a>.</p>
<pre><code>
</code></pre>
<h1 id="to-do">To do</h1>
<h2 id="supporting-apps-with-multiple-ui-threads-running-on-different-languages">Supporting apps with multiple UI threads running on different languages</h2>
<p>New implementation taking the basic ideas of Bodoconsult.I18N to multithreaded environments like an ASP.NET web application or GRPC based services in an client server environment with central localization of the server side.</p>
<h1 id="about-us">About us</h1>
<p>Bodoconsult (<a href="http://www.bodoconsult.de">http://www.bodoconsult.de</a>) is a Munich based software development company from Germany.</p>
<p>Robert Leisner is senior software developer at Bodoconsult. See his profile on <a href="http://www.bodoconsult.de/Curriculum_vitae_Robert_Leisner.pdf">http://www.bodoconsult.de/Curriculum_vitae_Robert_Leisner.pdf</a>.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Bodoconsult/Bodoconsult.AppInfrastructure/blob/main/docs/Bodoconsult.I18N/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
