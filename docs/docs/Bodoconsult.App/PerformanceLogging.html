<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Performance logging | Bodoconsult.AppInfrastructure </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Performance logging | Bodoconsult.AppInfrastructure ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Bodoconsult/Bodoconsult.AppInfrastructure/blob/main/docs/Bodoconsult.App/PerformanceLogging.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="Bodoconsult.AppInfrastructure">
            Bodoconsult.AppInfrastructure
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="performance-logging">Performance logging</h1>

<p>Performance logging infrastructure is implemented based on the <a href="https://learn.microsoft.com/en-us/dotnet/core/diagnostics/">https://learn.microsoft.com/en-us/dotnet/core/diagnostics/</a>.
So it can be used with professionell APM tools like Application Insights, dotnet-counters, and dotnet-monitor.</p>
<h2 id="iappeventsource--appeventsource">IAppEventSource / AppEventSource</h2>
<p>Event counters are a platform independent feature of .NET to implement application performance measurement. They are directly supported by Visual Studio, Application Insights, dotnet-counters and dotnet-monitor.</p>
<p>For basic information on event counters see <a href="https://learn.microsoft.com/en-us/dotnet/core/diagnostics/metrics," title="Microsoft diagnostics: Metrics">Microsoft diagnostics: Metrics</a>.</p>
<p>The implementations of IAppEventSource like AppEventSource deliver basic infrastructure for adding event counters to an app as easily as possible.</p>
<p>To define event counters for your app implement one or more IEventSourceProvider based instances an load them into IAppEventSource implementations via IAppEventSource.AddProvider.
Using multiple providers is recommend if your requires certain event counters only under certain circumstances.</p>
<p>As example see the implemtation of the BusinessTransactionEventSourceProvider:</p>
<pre><code class="lang-csharp">
/// &lt;summary&gt;
/// Provider for business transaction management relevante event counters
/// &lt;/summary&gt;
public class BusinessTransactionEventSourceProvider: IEventSourceProvider
{
    public const string BtmRunBusinessTransactionSuccess = &quot;Btm.RunBusinessTransaction.Success&quot;;

    public const string BtmRunBusinessTransactionDuration = &quot;Btm.RunBusinessTransaction.Duration&quot;;

    /// &lt;summary&gt;
    /// Add &lt;see cref=&quot;EventCounter&quot;/&gt; to the event source
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;eventSource&quot;&gt;Current event source&lt;/param&gt;
    public void AddEventCounters(AppApmEventSource eventSource)
    {
        CreateBtRunTransactionDurationEventCounter(eventSource);
    }

    private void CreateBtRunTransactionDurationEventCounter(AppApmEventSource eventSource)
    {
        var ec = new EventCounter(BtmRunBusinessTransactionDuration, eventSource);
        ec.DisplayName = &quot;Business transaction duration&quot;;
        ec.DisplayUnits = &quot;ms&quot;;

        eventSource.EventCounters.Add(BtmRunBusinessTransactionDuration, ec);
    }


    /// &lt;summary&gt;
    /// Add &lt;see cref=&quot;IncrementingEventCounter&quot;/&gt; to the event source
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;eventSource&quot;&gt;Current event source&lt;/param&gt;
    public void AddIncrementingEventCounters(AppApmEventSource eventSource)
    {
        CreateRunBtSuccessIncrementEventCounter(eventSource);
    }

    private void CreateRunBtSuccessIncrementEventCounter(AppApmEventSource eventSource)
    {
        var ec = new IncrementingEventCounter(BtmRunBusinessTransactionSuccess, eventSource);
        ec.DisplayName = &quot;Business transaction running successfully&quot;;
        ec.DisplayUnits = &quot;runs&quot;;

        eventSource.IncrementingEventCounters.Add(BtmRunBusinessTransactionSuccess, ec);
    }

    /// &lt;summary&gt;
    /// Add the &lt;see cref=&quot;PollingCounter&quot;/&gt; to the event source
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;eventSource&quot;&gt;Current event source&lt;/param&gt;
    public void AddPollingCounters(AppApmEventSource eventSource)
    {
        // Do nothing
    }

    /// &lt;summary&gt;
    /// Add &lt;see cref=&quot;IncrementingPollingCounter&quot;/&gt; to the event source
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;eventSource&quot;&gt;Current event source&lt;/param&gt;
    public void AddIncrementingPollingCounters(AppApmEventSource eventSource)
    {
        // Do nothing
    }
}

</code></pre>
<h2 id="iperformancelogger--performancelogger">IPerformanceLogger / PerformanceLogger</h2>
<p>The IPerformanceLogger implementations read performance counters and provide them as formatted string. PerformanceLogger class read main event counters provided by .NET runtime. It is intended to be used from inside the application.</p>
<pre><code class="lang-csharp">
// Arrange 
var logger = new PerformanceLogger();

// Act  
var s = logger.GetCountersAsString();

// Assert
Assert.That(!string.IsNullOrEmpty(s));
Debug.Print(s);

</code></pre>
<h2 id="iperformanceloggermanager--performanceloggermanager">IPerformanceLoggerManager / PerformanceLoggerManager</h2>
<p>The IPerformanceLoggerManager implementations are intended to fetch performance counter data from IPerformanceLogger implementations in a scheduled manner
and provide it as string to a delegate for further usage like logging.</p>
<pre><code class="lang-csharp">
var logger = new PerformanceLogger();

var manager = new PerformanceLoggerManager(logger)
{
    StatusMessageDelegate = StatusMessageDelegate
};

Assert.That(manager);
Assert.That(manager.PerformanceLogger);

// Act  
manager.StartLogging();

</code></pre>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Bodoconsult/Bodoconsult.AppInfrastructure/blob/main/docs/Bodoconsult.App/PerformanceLogging.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
